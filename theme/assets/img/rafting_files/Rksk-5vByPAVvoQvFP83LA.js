(function() {function n(a,b){this.v=a;this.namespace=void 0===b?null:b}n.prototype.setItem=function(a,b){try{return this.v.setItem(null==this.namespace?a:this.namespace+"."+a,b),!0}catch(c){return!1}};n.prototype.getItem=function(a){return this.v.getItem(null==this.namespace?a:this.namespace+"."+a)};n.prototype.removeItem=function(a){this.v.removeItem(null==this.namespace?a:this.namespace+"."+a)};function q(){this.xhr=null}q.prototype.cancel=function(){this.xhr&&(this.xhr.abort(),this.xhr=null)};q.prototype.finish=function(){this.xhr=null};function r(a){this.C=a&&a.analyticsContext||null;this.o=a&&a.authToken||null;this.u=a&&a.authzToken||null;this.D=a&&a.brandRestriction||null;this.F=a&&a.buildName||null;this.G=a&&a.buildSha||null;this.i=a&&a.csrfTokens||{};this.w=a&&a.serverRoot||null;this.O=!!this.w;this.R=this.w?this.w+"/_ajax":"/_ajax"}
function t(a){var b=a.indexOf("/",1);return-1==b?a:a.substring(0,b)}r.prototype.get=function(a,b){var c=new q;this.send("GET",a,null,!0,null,c,null,b);return c};r.prototype.post=function(a,b,c,f){var e=new q;u(this,"POST",a,b,!0,0,e,c,f);return e};
function u(a,b,c,f,e,g,k,l,m){var h=t(c);if(h in a.i){var d=a.i[h];a.send(b,c,f,e,d,k,l,function(p,y){418==p&&1>g?(a.i[h]==d&&delete a.i[h],u(a,b,c,f,e,g+1,k,l,m)):(m&&m(p,y),k.finish())})}else a.send("GET","/csrf"+h,null,e,null,k,null,function(d,y){200==d?(h in a.i||(a.i[h]=String(y)),u(a,b,c,f,e,g,k,l,m)):(m(d,null),k.finish())})}
r.prototype.send=function(a,b,c,f,e,g,k,l){function m(){4==d.readyState&&h()}function h(){var a,b,c;try{a=d.status;var e,h;try{e=d.getResponseHeader("X-Canva-Auth")}catch(f){}try{h=d.getResponseHeader("X-Canva-Authz")}catch(f){}e&&(p.o="!"!=e?e:null);h&&(p.u="!"!=h?h:null);b=d.responseText}catch(f){if(f.message&&f.message.match(/c00c023f/))a=0,b="";else throw g.finish(),f;}b=b&&b.trim?b.trim():"";e=b.substring(0,20);if(0<e.length){if("'\"])}while(1);\x3c/x\x3e//"!=e){l(500,null);g.finish();return}b=
b.substring(20);try{c=JSON.parse(b)}catch(f){l(500,null);g.finish();return}}else c=null;l(a,c);g.finish()}b=this.R+b;var d=g.xhr=new XMLHttpRequest,p=this;d.open(a,b,f);this.O&&(d.withCredentials=!0);"GET"!=a&&e&&d.setRequestHeader("X-Csrf-Token",e);this.C&&d.setRequestHeader("X-Canva-Analytics",this.C);this.o&&d.setRequestHeader("X-Canva-Auth",this.o);this.u&&d.setRequestHeader("X-Canva-Authz",this.u);this.D&&d.setRequestHeader("X-Canva-Brand",this.D);this.F&&d.setRequestHeader("X-Canva-Build-Name",
this.F);this.G&&d.setRequestHeader("X-Canva-Build-Sha",this.G);null===c?a=null:"object"==typeof c&&"undefined"!==typeof Blob&&c instanceof Blob?(d.setRequestHeader("Content-Type",c.type),k&&d.upload.addEventListener("progress",k,!1),a=c):(d.setRequestHeader("Content-Type","application/json;charset\x3dUTF-8"),a=JSON.stringify(c));f?(d.onreadystatechange=m,d.send(a)):(d.send(a),h())};function v(){this.view=null}v.prototype.j=function(a){var b=this;this.view&&(this.view.remove(),this.view=null);a&&(this.view=new w,this.view.render(a).$el.appendTo("body"),this.view.once("hide",function(){return b.trigger("hide")}))};v.prototype.on=Backbone.Events.on;v.prototype.off=Backbone.Events.off;v.prototype.trigger=Backbone.Events.trigger;function w(){}w=Backbone.View.extend({className:"systemAlert"});w.prototype.events=function(){return{"click .systemAlertHide":this.hide}};
w.prototype.hide=function(a){a.preventDefault();this.trigger("hide")};w.prototype.render=function(a){var b=this.el;soy.asserts.assertType(goog.isString(a)||a instanceof goog.soy.data.SanitizedContent,"message",a,"string|goog.soy.data.SanitizedContent");a=soydata.VERY_UNSAFE.ordainSanitizedHtml('\x3cp class\x3d"systemAlertMessage"\x3e'+soy.$$escapeHtml(a)+'\x3c/p\x3e\x3ca class\x3d"systemAlertHide" href\x3d"#"\x3eOK, hide\x3c/a\x3e');b.innerHTML=a;return this};function x(){}x.prototype.now=function(){return Date.now()};var z=new x;var B=new A;function A(){}A.prototype.setInterval=function(a,b){return window.setInterval(a,b)};A.prototype.clearInterval=function(a){window.clearInterval(a)};A.prototype.setTimeout=function(a,b){return window.setTimeout(a,b)};A.prototype.clearTimeout=function(a){window.clearTimeout(a)};A.prototype.requestAnimationFrame=function(a){return window.requestAnimationFrame(a)};A.prototype.cancelAnimationFrame=function(a){window.cancelAnimationFrame(a)};function C(a,b,c,f,e){var g=this;this.view=a;this.g=this.message=null;this.H=c;this.N=b;this.K=f;this.J=e;this.l=null;this.view.on("hide",function(){if(g.message){var a=g.H,b="acknowledged."+g.message,c=g.J.now();try{var e=JSON.stringify(c);a.setItem(b,e)}catch(d){}g.j(null)}})}function D(a){a.g&&a.g.cancel();a.g=a.N.get("/alerts/active",function(b,c){a.g=null;200===b&&a.j(c)})}
C.prototype.start=function(a){var b=this;null==this.l&&(this.j(void 0!==a?a:null),this.l=this.K.setInterval(function(){return D(b)},3E5))};C.prototype.stop=function(){null!=this.g&&(this.g.cancel(),this.g=null);null!=this.l&&this.K.clearInterval(this.l)};C.prototype.j=function(a){if(a){var b;try{var c=this.H.getItem("acknowledged."+a);b=null!==c?JSON.parse(c):null}catch(f){b=null}if(null!=b&&864E5>this.J.now()-b)return}this.message=a;this.view.j(a)};$(function(){var a;if(window.localStorage)a=new n(window.localStorage,"SystemAlertController");else throw Error("ClientStore: localStorage is not defined on window, likely an unsupported browser");(new C(new v,new r(window.httpServiceConfig),a,B,z)).start(window.systemAlert)});})();
